## 20.3 创建完整的根文件系统 (2017.12.14)

## `完成构建根文件系统的第一项 /dev/console /dev/null`
1. `首先根据 busybox.md 编译和安装 busybox`
2. `查看 /dev/console /dev/null`
```
galen@HD66:/work/nfs_root/first-fs$ ls /dev/console /dev/null -l
crw------- 1 root root 5, 1 Dec 13 07:44 /dev/console     // c : 字符设备  5 : 主设备号 1 : 次设备号
crw-rw-rw- 1 root root 1, 3 Dec 13 07:44 /dev/null
```
3. `mknod 命令建立一个目录项和一个特殊文件的对应索引节点。第一个参数是 Name 项设备的名称。选择一个描述性的设备名称` : `make node`
* node --- 节点
```
* galen@HD66:/work/nfs_root/first-fs$ mkdir dev
* galen@HD66:/work/nfs_root/first-fs$ cd dev
* galen@HD66:/work/nfs_root/first-fs/dev$ sudo mknod console c 5 1 
* galen@HD66:/work/nfs_root/first-fs/dev$ sudo mknod null c 1 3 
* galen@HD66:/work/nfs_root/first-fs/dev$ ls -l
    total 0
    crw-r--r-- 1 root root 5, 1 Dec 13 16:00 console
    crw-r--r-- 1 root root 1, 3 Dec 13 17:32 null  
```

## `完成构建根文件系统的第三项 /etc/inittab`
1. galen@HD66:/work/nfs_root/first-fs/dev$ cd ..
2. galen@HD66:/work/nfs_root/first-fs$ mkdir etc
3. galen@HD66:/work/nfs_root/first-fs$ cd etc/
4. galen@HD66:/work/nfs_root/first-fs/etc$ touch inittab
5. galen@HD66:/work/nfs_root/first-fs/etc$ vim inittab 
6. 输入: console::askfirst:-bin/sh ;  :wq!        // 标准输入、标准输出、标准错误输出都定位到console这个终端里面

## `完成构建根文件系统的第四项 配置文件指定的程序`
* 配置文件指定的程序 (现在还没有必要做)

## `完成构建根文件系统的第五项 C库`
1. galen@HD66:/work/nfs_root/first-fs/etc$ cd /work/tools/gcc-3.4.5-glibc-2.3.6/arm-linux/lib
2. ls -l // .a 为静态库 .so 动态库
3. galen@HD66:/work/tools/gcc-3.4.5-glibc-2.3.6/arm-linux/lib$ mkdir /work/nfs_root/first-fs/lib
4. galen@HD66:/work/tools/gcc-3.4.5-glibc-2.3.6/arm-linux/lib$ cp *.so* /work/nfs_root/first-fs/lib -d
* `-d : 链接文件保持为链接文件，若不加上 -d 选项,拷贝链接文件的时候实际上我们会拷贝链接文件所指向的原始文件，大大增加了文件的大小`
5. galen@HD66:/work/tools/gcc-3.4.5-glibc-2.3.6/arm-linux/lib$ cd /work/nfs_root/first-fs/
6. galen@HD66:/work/nfs_root/first-fs$ ls
bin  dev  etc  lib  linuxrc  sbin  usr          // 最小的文件系统 

## 到目前为止已经制作了一个最小的文件系统，但是我们要把它烧进开发板中使用
## 就需要制作成镜像文件
1. galen@HD66:/work/system$ tar jxf yaffs_source_util_larger_small_page_nand.tar.bz2 
2. galen@HD66:/work/system$ cd Development_util_ok/
3. galen@HD66:/work/system/Development_util_ok$ cd yaffs2/utils/
4. galen@HD66:/work/system/Development_util_ok/yaffs2/utils$ make
* 执行make命令生成mkyaffs2image工具 
5. galen@HD66:/work/system/Development_util_ok/yaffs2/utils$ sudo cp mkyaffs2image /usr/local/bin/
6. galen@HD66:/work/system/Development_util_ok/yaffs2/utils$ sudo chmod +x /usr/local/bin/mkyaffs2image
7. galen@HD66:/work/system/Development_util_ok/yaffs2/utils$ cd /work/nfs_root/
8. galen@HD66:/work/nfs_root$ mkyaffs2image 
    mkyaffs2image: image building tool for YAFFS2 built Dec 13 2017
    usage: mkyaffs2image dir image_file [convert]                                   // 用法
           dir        the directory tree to be converted
           image_file the output file to hold the image
           'convert'  produce a big-endian image from a little-endian machine
9. galen@HD66:/work/nfs_root$ mkyaffs2image first-fs first_fs.yaffs2                // 制作镜像
10. galen@HD66:/work/nfs_root$ ls       // first_fs.yaffs2 即为第一个文件系统镜像文件
```
drivers_and_test  first-fs  first_fs.yaffs2  fs_mini_mdev.tar.bz2  fs_mini.tar.bz2  fs_qtopia.tar.bz2  fs_xwindow.tar.bz2  hardware  tmp  uImage
```
11. 通过 dnw(USB方式)烧写到开发板中
 